<div class="room-container">

    <!-- OWNER VIEW -->
    <div class="card" *ngIf="isOwner">
  <div class="card-header">
    <button class="back-btn" (click)="goBack()">← Back</button>
    <h2 class="card-title">Create Room</h2>
  </div>

  <!-- Max Players -->
  <div class="form-group">
    <label>Max Players <span class="required">*</span></label>
    <input
      type="number"
      placeholder="Enter number of players"
      [(ngModel)]="maxPlayers"
      min=2 max=10
      required
    />
    <span class="input-focus-line"></span>
  </div>

  <!-- Session Time -->
  <div class="form-group">
    <label>Session Time <span class="required">*</span></label>
    <select [(ngModel)]="sessionTime" required>
      <option value="" disabled>Select time</option>
      <option value="5">5 minutes</option>
      <option value="10">10 minutes</option>
      <option value="15">15 minutes</option>
    </select>
  </div>

  <!-- Session Name -->
  <div class="form-group">
    <label class="d-flex align-items-center gap-2">
      Session Name
      <i
        class="bi bi-info-circle info-icon"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
        title="This name will be saved for your reference in future if you choose to save this session"
      ></i>
    </label>

    <input
      type="text"
      placeholder="e.g. Weekly Quiz – Team A"
      [(ngModel)]="sessionName"
    />
    <span class="input-focus-line"></span>
  </div>

  <!-- Save Session Toggle -->
  <div class="form-group toggle-group" *ngIf="isOwner">
    <label class="toggle-label d-flex align-items-center gap-2">
      <input
        type="checkbox"
        [(ngModel)]="saveSession"
        (change)="onSaveSessionChange()"
        [disabled]="!currentUser"
        class="form-check-input"
        style="cursor: pointer;"
      />
      <span [class.disabled-text]="!currentUser">Save this session</span>
      <i
        class="bi bi-info-circle info-icon"
        title="This requires login. After clicking, the session will be saved and you can review the buzzed list later."
        style="cursor: help;"
      ></i>
    </label>
    <small *ngIf="!currentUser" class="login-required-text">Login required to save sessions</small>
  </div>

   <!-- User Login Status -->
  <div class="form-group" *ngIf="isOwner">
    <div class="login-status" *ngIf="currentUser; else notLoggedIn">
      <div class="user-info">
        <span class="user-name">Logged in as: <strong>{{ currentUser.name }}</strong></span>
        <div class="user-actions">
          <a (click)="this.router.navigate(['/my-sessions'])" class="my-sessions-link">My Sessions</a>
          <button type="button" class="logout-btn" (click)="authService.logout(); currentUser = null">Logout</button>
        </div>
      </div>
    </div>
    <ng-template #notLoggedIn>
      <div class="login-prompt">
        <p class="login-text">Want to save sessions? <a (click)="goToLogin()" class="login-link">Login</a></p>
      </div>
    </ng-template>
  </div>

  <!-- Invite Link -->
  <div class="form-group">
    <label>Invite Link</label>
    <div class="invite-box">
      <input type="text" [(ngModel)]="roomLink" readonly />
      <button class="copy-btn" (click)="copyLink()">Copy</button>
    </div>
    <small *ngIf="copied" class="copy-success">
      Link copied to clipboard!
    </small>
  </div>

  <!-- Start Game -->
  <button class="primary-btn" (click)="startGame()">Start Game</button>

  <p class="switch-text">
    Want to join instead?
    <span class="link" (click)="switchToUser()">Join Room</span>
  </p>
</div>


    <!-- USER VIEW -->
    <div class="card" *ngIf="!isOwner">
        <div class="card-header">
            <button class="back-btn" (click)="goBack()">← Back</button>
            <h2 class="card-title">Join Room</h2>
        </div>


        <div class="form-group">
            <label>Room ID</label>
            <input type="text" placeholder="Enter Room ID" [(ngModel)]="userRoomId" />
        </div>

        <button class="primary-btn" (click)="joinRoomAsUser()">Join Room</button>

        <p class="switch-text">
            Wanna create room?
            <span class="link" (click)="switchToOwner()">Create here</span>
        </p>
    </div>

</div>

<!--BootStrap Validation Modal -->

<div
  class="modal fade"
  tabindex="-1"
  #validationModal
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Incomplete Details</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeModal()"
        ></button>
      </div>

      <div class="modal-body">
        Please fill all mandatory fields before starting the game.
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="closeModal()"
        >
          OK
        </button>
      </div>

    </div>
  </div>
</div>

